<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>Avalanches ‚Äî Card√°pio Digital</title>
  
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <style>
    :root {
      --bg: #141416;         
      --card: #232326;       
      --input-bg: #2c2c2e;
      --muted: #9ca3af;
      --text: #ffffff;
      --accent: #ff9f0a;
      --success: #34c759;    
      --danger: #ff453a;
      --radius: 18px;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html, body { height: 100%; margin: 0; background-color: var(--bg); font-family: -apple-system, system-ui, sans-serif; color: var(--text); overflow-x: hidden; }

    .app { max-width: 500px; margin: 0 auto; padding: 16px; padding-bottom: 100px; min-height: 100vh; }

    /* ESTADO FECHADO */
    body.closed .sticky-controls, body.closed .menu-list, body.closed .cartbar, body.closed #cartPage, body.closed #modal {
      opacity: 0.5; filter: grayscale(100%); pointer-events: none; user-select: none;
    }

    #toast-container { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 9999; width: 90%; max-width: 400px; pointer-events: none; }
    .toast { background: rgba(40, 40, 43, 0.95); color: #fff; padding: 14px 20px; border-radius: 50px; font-size: 14px; font-weight: 600; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; animation: slideDown 0.4s forwards; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
    @keyframes slideDown { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

    .topbar { display: flex; flex-direction: column; align-items: center; margin-bottom: 20px; padding: 20px; background: var(--card); border-radius: 24px; text-align: center; border: 1px solid rgba(255,255,255,0.05); }
    
    .logo { width: 64px; height: 64px; border-radius: 50%; border: 2px solid var(--accent); margin-bottom: 10px; object-fit: cover; }
    
    .brand h1 { margin: 0; font-size: 24px; }
    .status-badge { display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 100px; font-size: 11px; font-weight: 700; text-transform: uppercase; margin-bottom: 12px; border: 1px solid rgba(52, 199, 89, 0.3); color: var(--success); }
    .status-badge.closed { color: var(--danger); border-color: var(--danger); }
    .status-dot { width: 8px; height: 8px; background: currentColor; border-radius: 50%; }

    .sticky-controls { position: sticky; top: 0; z-index: 10; background: rgba(20, 20, 22, 0.9); backdrop-filter: blur(10px); padding: 10px 0; }
    .search { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #333; background: var(--input-bg); color: #fff; }
    .tabs { display: flex; gap: 8px; overflow-x: auto; padding: 10px 0; }
    .tab { padding: 8px 16px; border-radius: 20px; background: #333; color: var(--muted); border: none; white-space: nowrap; cursor: pointer; }
    .tab.active { background: var(--accent); color: #000; }

    .card { display: flex; gap: 12px; background: var(--card); padding: 10px; border-radius: 16px; margin-bottom: 12px; cursor: pointer; }
    .thumb { width: 80px; height: 80px; border-radius: 12px; overflow: hidden; flex-shrink: 0; }
    .thumb img { width: 100%; height: 100%; object-fit: cover; }
    .info { flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
    .price { color: var(--accent); font-weight: 700; }

    .cartbar { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 450px; background: #1c1c1e; padding: 12px 20px; border-radius: 100px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 10px 30px #000; z-index: 99; border: 1px solid #333; }
    .btn-view-cart { background: var(--accent); border: none; padding: 10px 20px; border-radius: 50px; font-weight: 700; cursor: pointer; }

    .page-slide { position: fixed; inset: 0; background: var(--bg); z-index: 200; transform: translateX(100%); transition: 0.3s; display: flex; flex-direction: column; }
    .page-slide.active { transform: translateX(0); }
    .page-content { flex: 1; overflow-y: auto; padding: 20px; }
    .modal-back { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; align-items: flex-end; justify-content: center; z-index: 300; }
    .modal-card { background: #1c1c1e; width: 100%; max-width: 500px; border-radius: 24px 24px 0 0; padding: 20px; max-height: 90vh; overflow-y: auto; }

    .clean-input { width: 100%; padding: 14px; border-radius: 12px; background: var(--input-bg); border: 1px solid #333; color: #fff; margin-bottom: 10px; }
    .pay-option { display: flex; align-items: center; padding: 12px; background: #2c2c2e; border-radius: 12px; margin-bottom: 8px; cursor: pointer; border: 1px solid transparent; }
    .pay-option.selected { border-color: var(--accent); background: rgba(255,159,10,0.1); }
    
    .map-container { width: 100%; height: 220px; border-radius: 12px; margin-bottom: 10px; overflow: hidden; border: 1px solid #444; position: relative; }
    #map { width: 100%; height: 100%; z-index: 1; }

    .btn { width: 100%; padding: 14px; border-radius: 12px; border: none; font-weight: 700; cursor: pointer; margin-bottom: 8px; }
    .btn.primary { background: var(--accent); color: #000; }
    .btn.whatsapp { background: #25D366; color: #fff; }
    .btn.ghost { background: transparent; color: #999; border: 1px solid #333; }
    .btn.back { background: #333; color: #fff; }
    .btn.location { background: #007aff; color: #fff; font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 8px; }
  </style>
</head>
<body>

  <div id="toast-container"></div>

  <main class="app">
    <header class="topbar">
      <img src="logo.jpeg" class="logo">
      <div class="brand">
        <h1>Avalanches</h1>
        <p style="font-size:12px; color:#999; margin: 4px 0 8px 0;">Seg a Dom: 19:00 √†s 23:59</p>
        <div class="status-badge" id="storeStatus"><span class="status-dot"></span> Carregando...</div>
      </div>
    </header>

    <div class="sticky-controls">
      <input id="search" class="search" placeholder="O que deseja hoje?">
      <div class="tabs">
        <button class="tab active" data-cat="all">Tudo</button>
        <button class="tab" data-cat="hamburgueres">Burguers</button>
        <button class="tab" data-cat="bebidas">Bebidas</button>
      </div>
    </div>

    <section id="menuList" class="menu-list"></section>
  </main>

  <nav class="cartbar" id="cartbar" style="display:none;">
    <div>
      <div style="font-size:10px; color:#999">Total estimado</div>
      <div id="cartSubtotal" style="font-weight:800; font-size:18px;">R$ 0,00</div>
    </div>
    <button id="openCartBtn" class="btn-view-cart">Ver Sacola</button>
  </nav>

  <div id="cartPage" class="page-slide">
    <div style="padding:15px; display:flex; align-items:center; gap:15px; border-bottom:1px solid #333;">
      <button id="closeCartBtnHeader" class="btn-view-cart" style="padding:8px 15px;">‚Üê</button>
      <span style="font-weight:700;">Finalizar Pedido</span>
    </div>
    <div class="page-content">
      <div id="cartItems"></div>
      
      <h3 style="color:var(--accent); font-size:14px; margin-top:20px;">üìç ENTREGA</h3>
      <button onclick="getLocation()" class="btn location">üìç CLIQUE AQUI PARA LOCALIZAR</button>
      <div class="map-container">
        <div id="map"></div>
      </div>
      <input id="clientAddress" class="clean-input" placeholder="Rua e Bairro *">
      <input id="houseNumber" class="clean-input" placeholder="N√∫mero da casa e Refer√™ncia *">
      <input id="clientName" class="clean-input" placeholder="Seu Nome *">

      <h3 style="color:var(--accent); font-size:14px; margin-top:20px;">üí≥ PAGAMENTO</h3>
      <div class="pay-option" onclick="selectPay(this, 'dinheiro')">üíµ Dinheiro</div>
      <div id="cashChange" style="display:none;">
        <input id="cashGiven" type="number" class="clean-input" placeholder="Troco para quanto?">
      </div>
      <div class="pay-option" onclick="selectPay(this, 'pix')">üí† PIX</div>
      <div class="pay-option" onclick="selectPay(this, 'cartao')">üí≥ Cart√£o</div>

      <div style="margin-top:20px; border-top:1px dashed #333; padding-top:15px;">
        <div style="display:flex; justify-content:space-between; margin-bottom:5px;"><span>Subtotal</span> <span id="subtotalText">R$ 0,00</span></div>
        <div style="display:flex; justify-content:space-between; margin-bottom:5px;"><span>Taxa Entrega</span> <span>R$ 4,99</span></div>
        <div style="display:flex; justify-content:space-between; font-size:20px; font-weight:800; color:var(--accent);"><span>Total</span> <span id="totalText">R$ 0,00</span></div>
      </div>

      <div style="margin-top: 25px;">
          <button id="backToMenu" class="btn back">Voltar para o Card√°pio</button>
          <button id="confirmBtn" class="btn primary">Enviar Pedido para WhatsApp</button>
      </div>
    </div>
  </div>

  <div id="modal" class="modal-back">
    <div class="modal-card">
      <img id="modalImg" style="width:100%; height:180px; object-fit:cover; border-radius:12px; margin-bottom:15px;">
      <h2 id="modalTitle" style="margin:0;"></h2>
      <p id="modalDesc" style="color:#999; font-size:14px;"></p>
      <div style="font-size:22px; font-weight:800; color:var(--accent); margin:10px 0;">R$ <span id="modalPrice">0,00</span></div>
      <div id="addonsSection" style="display:none;">
        <p style="font-size:12px; font-weight:700; margin-bottom:10px;">ADICIONAIS</p>
        <div id="addonsList"></div>
      </div>
      <textarea id="note" class="clean-input" style="height:80px; margin-top:15px;" placeholder="Alguma observa√ß√£o?"></textarea>
      <div style="display:flex; align-items:center; gap:15px; margin-top:15px;">
        <div style="display:flex; align-items:center; background:#333; border-radius:10px; padding:5px;">
          <button onclick="changeQty(-1)" style="background:none; border:none; color:#fff; padding:10px; font-size:20px;">-</button>
          <input id="qtyInput" value="1" readonly style="width:30px; text-align:center; background:none; border:none; color:#fff; font-weight:700;">
          <button onclick="changeQty(1)" style="background:none; border:none; color:#fff; padding:10px; font-size:20px;">+</button>
        </div>
        <button id="addCart" class="btn primary" style="flex:1;">Adicionar</button>
      </div>
      <button onclick="el('modal').style.display='none'" class="btn ghost" style="margin-top:10px;">Cancelar</button>
    </div>
  </div>

  <div id="pixModal" class="modal-back" style="z-index: 400;">
    <div class="modal-card" style="text-align:center;">
      <div style="font-size:40px;">üí†</div>
      <h3>Pagamento PIX</h3>
      <div style="background:#2c2c2e; padding:15px; border-radius:10px; word-break:break-all; font-family:monospace; margin-bottom:15px;" id="pixKeyDisplay"></div>
      <button onclick="copyPix()" class="btn primary">Copiar Chave PIX</button>
      <button id="btnSendPixWa" class="btn whatsapp" style="margin-top:10px;">J√° paguei, enviar pedido!</button>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const CONFIG = { phone: '5534984405375', fee: 4.99, pixKey: '14421d15-c771-4ab9-8e7f-fd69e987af1a' };
    
    // BANCO DE DADOS COMPLETO RESTAURADO
    const DB = [
      {"id":"i_cq","cat":"hamburgueres","name":"Cachorro Quente","desc":"P√£o, salsicha, mortadela, mussarela, batata, milho, molho","price":7.0, "image":"cachoro quente na chapa.jpeg"},
      {"id":"i_hb","cat":"hamburgueres","name":"Hamb√∫rguer","desc":"P√£o, carne, batata, alface, tomate, molho especial","price":12.0, "image":"logo.jpeg"},
      {"id":"i_xb","cat":"hamburgueres","name":"X-Burguer","desc":"P√£o, carne, mussarela, batata, milho, alface, tomate","price":15.0, "image":"xburguer.jpeg"},
      {"id":"i_xs","cat":"hamburgueres","name":"X-Salada","desc":"P√£o, carne, mussarela, presunto, alface, tomate, milho, batata","price":16.0, "image":"xburguer.jpeg"},
      {"id":"i_xe","cat":"hamburgueres","name":"X-Egg","desc":"P√£o, carne, mussarela, ovo, presunto, salada, batata","price":17.0, "image":"xburguer.jpeg"},
      {"id":"i_xc","cat":"hamburgueres","name":"X-Calabresa","desc":"P√£o, carne, mussarela, calabresa, salada, batata","price":18.0, "image":"xburguer.jpeg"},
      {"id":"i_xba","cat":"hamburgueres","name":"X-Bacon","desc":"P√£o, carne, mussarela, bacon, salada, batata","price":19.0, "image":"xburguer.jpeg"},
      {"id":"i_fb","cat":"hamburgueres","name":"Franburguer","desc":"P√£o, frango desfiado, mussarela, salada, batata, milho","price":18.0, "image":"logo.jpeg"},
      {"id":"i_xtudo","cat":"hamburgueres","name":"X-Tudo","desc":"P√£o, carne, bacon, ovo, presunto, mussarela, calabresa, milho, batata, salada","price":25.0, "image":"xtudo.jpeg"},
      {"id":"i_av","cat":"hamburgueres","name":"Avalanches","desc":"P√£o, carne, bacon, frango, ovo, presunto, mussarela, calabresa, cebola roxa, milho, batata, tudo","price":27.0, "image":"Avalanche.jpeg"},
      {"id":"b_coca2","cat":"bebidas","name":"Coca-Cola 2L","desc":"Garrafa 2 litros","price":15.0, "image":"coca-cola 2l.jpg"},
      {"id":"b_coca350","cat":"bebidas","name":"Coca-Cola Lata","desc":"350ml","price":5.5, "image":"coca-cola lata.jpg"},
      {"id":"a_carne","cat":"adicionais","name":"Carne","price":4.0},
      {"id":"a_bacon","cat":"adicionais","name":"Bacon","price":4.0},
      {"id":"a_ovo","cat":"adicionais","name":"Ovo","price":3.0}
    ];

    const ITEMS = DB.filter(i => i.cat !== 'adicionais');
    const ADDONS = DB.filter(i => i.cat === 'adicionais');
    let CART = {};
    let PAYMENT = '';
    let WA_MSG = '';
    let currentProd = null;
    let selectedAddons = [];
    let map, marker;

    const el = id => document.getElementById(id);
    const fmt = v => 'R$ ' + Number(v).toFixed(2).replace('.',',');

    function checkOpen() {
      const h = new Date().getHours();
      const isOpen = (h >= 19 || h < 3);
      const b = el('storeStatus');
      if(isOpen) { b.innerHTML = '<span class="status-dot" style="background:var(--success)"></span> Aberto Agora'; document.body.classList.remove('closed'); } 
      else { b.innerHTML = '<span class="status-dot" style="background:var(--danger)"></span> Fechado'; document.body.classList.add('closed'); }
    }
    checkOpen();

    function render(cat='all', q='') {
      const list = el('menuList'); list.innerHTML='';
      const filtered = ITEMS.filter(i => (cat==='all' || i.cat===cat) && i.name.toLowerCase().includes(q.toLowerCase()));
      filtered.forEach(it => {
        const div = document.createElement('div');
        div.className = 'card';
        div.onclick = () => openProd(it);
        div.innerHTML = `<div class="thumb"><img src="${it.image}"></div><div class="info"><div><div style="font-weight:700">${it.name}</div><div style="font-size:12px;color:#999">${it.desc}</div></div><div class="price">${fmt(it.price)}</div></div>`;
        list.appendChild(div);
      });
    }

    function openProd(it) {
      currentProd = it; selectedAddons = [];
      el('modalTitle').innerText = it.name; el('modalDesc').innerText = it.desc; el('modalImg').src = it.image;
      el('qtyInput').value = 1; el('note').value = '';
      const adds = el('addonsList'); adds.innerHTML = '';
      if(it.cat === 'hamburgueres') {
        el('addonsSection').style.display = 'block';
        ADDONS.forEach(a => {
          const d = document.createElement('div');
          d.style = "display:flex; justify-content:space-between; padding:8px; background:#2c2c2e; border-radius:8px; margin-bottom:5px; font-size:13px;";
          d.innerHTML = `<span>${a.name} (+${fmt(a.price)})</span> <input type="checkbox" onchange="toggleAddon('${a.id}', ${a.price}, this)">`;
          adds.appendChild(d);
        });
      } else { el('addonsSection').style.display = 'none'; }
      updateModalPrice();
      el('modal').style.display = 'flex';
    }

    window.toggleAddon = (id, price, chk) => {
      if(chk.checked) selectedAddons.push({id, price, name: ADDONS.find(x=>x.id===id).name});
      else selectedAddons = selectedAddons.filter(x=>x.id!==id);
      updateModalPrice();
    };

    function updateModalPrice() {
      const base = currentProd.price; const adds = selectedAddons.reduce((a,b)=>a+b.price, 0);
      el('modalPrice').innerText = ((base + adds) * el('qtyInput').value).toFixed(2).replace('.',',');
    }

    window.changeQty = (v) => { let q = parseInt(el('qtyInput').value) + v; if(q < 1) q = 1; el('qtyInput').value = q; updateModalPrice(); };

    el('addCart').onclick = () => {
      const id = currentProd.id + selectedAddons.map(a=>a.id).join('');
      if(CART[id]) { CART[id].qty += parseInt(el('qtyInput').value); } 
      else { CART[id] = { name: currentProd.name, price: currentProd.price, qty: parseInt(el('qtyInput').value), addons: [...selectedAddons], note: el('note').value }; }
      el('modal').style.display='none'; updateCartBar(); showToast("Adicionado!");
    };

    function updateCartBar() {
      let sub = 0, count = 0;
      for(let k in CART) { const it = CART[k]; sub += (it.price + it.addons.reduce((a,b)=>a+b.price,0)) * it.qty; count++; }
      el('cartbar').style.display = count > 0 ? 'flex' : 'none';
      el('cartSubtotal').innerText = fmt(sub); el('subtotalText').innerText = fmt(sub);
      el('totalText').innerText = fmt(sub + CONFIG.fee);
    }

    function renderCartItems() {
      const c = el('cartItems'); c.innerHTML = '';
      for(let k in CART) {
        const it = CART[k];
        const d = document.createElement('div');
        d.style = "padding:10px 0; border-bottom:1px solid #333; display:flex; justify-content:space-between;";
        d.innerHTML = `<div><b>${it.qty}x ${it.name}</b><br><small>${it.addons.map(a=>a.name).join(', ')}</small></div> <span>${fmt((it.price + it.addons.reduce((a,b)=>a+b.price,0)) * it.qty)}</span>`;
        c.appendChild(d);
      }
    }

    window.selectPay = (div, type) => {
      PAYMENT = type; document.querySelectorAll('.pay-option').forEach(p => p.classList.remove('selected'));
      div.classList.add('selected'); el('cashChange').style.display = type === 'dinheiro' ? 'block' : 'none';
    };

    // MAPA LEAFLET COM GPS FOR√áADO
    function initMap(lat = -15.487, lon = -44.367) {
      if(map) { map.setView([lat, lon], 17); marker.setLatLng([lat, lon]); return; }
      map = L.map('map').setView([lat, lon], 17);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
      marker = L.marker([lat, lon], {draggable: true}).addTo(map);
    }

    function getLocation() {
      showToast("Aguardando permiss√£o...");
      navigator.geolocation.getCurrentPosition((pos) => {
        const lat = pos.coords.latitude; const lon = pos.coords.longitude;
        initMap(lat, lon);
        fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`)
        .then(r => r.json()).then(d => {
          if(d.display_name) el('clientAddress').value = d.display_name.split(',')[0] + ', ' + d.display_name.split(',')[1];
          showToast("Localizado!");
        });
      }, (err) => {
        showToast("Por favor, ative o GPS do celular.");
        console.error(err);
      }, { enableHighAccuracy: true });
    }

    el('confirmBtn').onclick = () => {
      const name = el('clientName').value, addr = el('clientAddress').value, num = el('houseNumber').value;
      if(!name || !addr || !num || !PAYMENT) return showToast("Preencha tudo!");
      let txt = `*üçî NOVO PEDIDO - AVALANCHES*\n----------------------------\nüë§ *Cliente:* ${name}\nüìç *Endere√ßo:* ${addr}, ${num}\nüí≥ *Pagamento:* ${PAYMENT.toUpperCase()}\n`;
      if(PAYMENT === 'dinheiro' && el('cashGiven').value) txt += `üíµ *Troco para:* R$ ${el('cashGiven').value}\n`;
      txt += `----------------------------\n\n`;
      let sub = 0;
      for(let k in CART) {
        const it = CART[k]; const itemTotal = (it.price + it.addons.reduce((a,b)=>a+b.price,0)) * it.qty;
        sub += itemTotal; txt += `*${it.qty}x ${it.name}*\n${it.addons.map(a=>` + ${a.name}`).join('\n')}\n${it.note ? ` _Obs: ${it.note}_\n` : ''}üí∞ ${fmt(itemTotal)}\n\n`;
      }
      txt += `----------------------------\nüì¶ *Entrega:* ${fmt(CONFIG.fee)}\nüí∞ *TOTAL:* ${fmt(sub + CONFIG.fee)}`;
      WA_MSG = txt;
      if(PAYMENT === 'pix') { el('pixKeyDisplay').innerText = CONFIG.pixKey; el('pixModal').style.display = 'flex'; } 
      else { window.open(`https://wa.me/${CONFIG.phone}?text=${encodeURIComponent(txt)}`); }
    };

    el('backToMenu').onclick = () => el('cartPage').classList.remove('active');
    el('closeCartBtnHeader').onclick = () => el('cartPage').classList.remove('active');
    window.copyPix = () => { navigator.clipboard.writeText(CONFIG.pixKey); showToast("Copiado!"); };
    el('btnSendPixWa').onclick = () => window.open(`https://wa.me/${CONFIG.phone}?text=${encodeURIComponent(WA_MSG)}`);
    function showToast(m) { const t = document.createElement('div'); t.className = 'toast'; t.innerText = m; el('toast-container').appendChild(t); setTimeout(() => t.remove(), 3000); }
    el('openCartBtn').onclick = () => { renderCartItems(); el('cartPage').classList.add('active'); setTimeout(() => initMap(), 400); };
    el('search').oninput = (e) => render('all', e.target.value);
    document.querySelectorAll('.tab').forEach(t => { t.onclick = () => { document.querySelectorAll('.tab').forEach(x => x.classList.remove('active')); t.classList.add('active'); render(t.dataset.cat); }; });
    render();
  </script>
</body>
</html>
