<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>Avalanches ‚Äî Card√°pio Digital</title>
  
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <style>
    :root {
      --bg: #141416;         
      --card: #232326;       
      --input-bg: #2c2c2e;
      --muted: #9ca3af;
      --text: #ffffff;
      --accent: #ff9f0a;
      --success: #34c759;    
      --danger: #ff453a;
      --radius: 18px;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html, body { height: 100%; margin: 0; background-color: var(--bg); font-family: -apple-system, system-ui, sans-serif; color: var(--text); overflow-x: hidden; }

    .app { max-width: 500px; margin: 0 auto; padding: 16px; padding-bottom: 100px; min-height: 100vh; }

    /* AJUSTE DA LOGO PARA N√ÉO DISTORCER */
    .topbar { display: flex; flex-direction: column; align-items: center; margin-bottom: 20px; padding: 20px; background: var(--card); border-radius: 24px; text-align: center; border: 1px solid rgba(255,255,255,0.05); }
    .logo { width: 80px; height: 80px; border-radius: 50%; border: 2px solid var(--accent); margin-bottom: 12px; object-fit: contain; background: #000; }
    
    .brand h1 { margin: 0; font-size: 24px; }
    .status-badge { display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 100px; font-size: 11px; font-weight: 700; text-transform: uppercase; margin-bottom: 12px; border: 1px solid rgba(52, 199, 89, 0.3); color: var(--success); }
    .status-badge.closed { color: var(--danger); border-color: var(--danger); }
    .status-dot { width: 8px; height: 8px; background: currentColor; border-radius: 50%; }

    /* INFO DE HOR√ÅRIOS */
    .opening-info { font-size: 12px; color: var(--muted); line-height: 1.4; margin-top: 5px; }

    .sticky-controls { position: sticky; top: 0; z-index: 10; background: rgba(20, 20, 22, 0.9); backdrop-filter: blur(10px); padding: 10px 0; }
    .search { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #333; background: var(--input-bg); color: #fff; }
    .tabs { display: flex; gap: 8px; overflow-x: auto; padding: 10px 0; }
    .tab { padding: 8px 16px; border-radius: 20px; background: #333; color: var(--muted); border: none; white-space: nowrap; cursor: pointer; }
    .tab.active { background: var(--accent); color: #000; }

    .card { display: flex; gap: 12px; background: var(--card); padding: 10px; border-radius: 16px; margin-bottom: 12px; cursor: pointer; }
    .thumb { width: 80px; height: 80px; border-radius: 12px; overflow: hidden; flex-shrink: 0; }
    .thumb img { width: 100%; height: 100%; object-fit: cover; }
    
    .cartbar { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 450px; background: #1c1c1e; padding: 12px 20px; border-radius: 100px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 10px 30px #000; z-index: 99; border: 1px solid #333; }
    .btn-view-cart { background: var(--accent); border: none; padding: 10px 20px; border-radius: 50px; font-weight: 700; cursor: pointer; }

    .page-slide { position: fixed; inset: 0; background: var(--bg); z-index: 200; transform: translateX(100%); transition: 0.3s; display: flex; flex-direction: column; }
    .page-slide.active { transform: translateX(0); }
    .page-content { flex: 1; overflow-y: auto; padding: 20px; }
    
    .map-container { width: 100%; height: 220px; border-radius: 12px; margin-bottom: 10px; overflow: hidden; border: 1px solid #444; position: relative; }
    #map { width: 100%; height: 100%; z-index: 1; }

    .btn { width: 100%; padding: 14px; border-radius: 12px; border: none; font-weight: 700; cursor: pointer; margin-bottom: 8px; }
    .btn.primary { background: var(--accent); color: #000; }
    .btn.back { background: #333; color: #fff; }
    .btn.location { background: #007aff; color: #fff; font-size: 14px; margin-bottom: 10px; }
    .clean-input { width: 100%; padding: 14px; border-radius: 12px; background: var(--input-bg); border: 1px solid #333; color: #fff; margin-bottom: 10px; }
    
    #toast-container { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 9999; width: 90%; max-width: 400px; pointer-events: none; }
    .toast { background: rgba(40, 40, 43, 0.95); color: #fff; padding: 14px 20px; border-radius: 50px; font-size: 14px; font-weight: 600; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; animation: slideDown 0.4s forwards; border: 1px solid rgba(255,255,255,0.1); text-align: center;}
    @keyframes slideDown { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

    .modal-back { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; align-items: flex-end; justify-content: center; z-index: 300; }
    .modal-card { background: #1c1c1e; width: 100%; max-width: 500px; border-radius: 24px 24px 0 0; padding: 20px; max-height: 90vh; overflow-y: auto; }
  </style>
</head>
<body>

  <div id="toast-container"></div>

  <main class="app">
    <header class="topbar">
      <img src="logo.jpeg" class="logo" alt="Logo">
      <div class="brand">
        <h1>Avalanches</h1>
        <div class="status-badge" id="storeStatus"><span class="status-dot"></span> Verificando...</div>
        <div class="opening-info">
          üìç Janu√°ria - MG<br>
          üïí Ter√ßa a Domingo: 19:00 √†s 03:00
        </div>
      </div>
    </header>

    <div class="sticky-controls">
      <input id="search" class="search" placeholder="O que deseja hoje?">
      <div class="tabs">
        <button class="tab active" data-cat="all">Tudo</button>
        <button class="tab" data-cat="hamburgueres">Burguers</button>
        <button class="tab" data-cat="bebidas">Bebidas</button>
      </div>
    </div>

    <section id="menuList" class="menu-list"></section>
  </main>

  <nav class="cartbar" id="cartbar" style="display:none;">
    <div>
      <div style="font-size:10px; color:#999">Total estimado</div>
      <div id="cartSubtotal" style="font-weight:800; font-size:18px;">R$ 0,00</div>
    </div>
    <button id="openCartBtn" class="btn-view-cart">Ver Sacola</button>
  </nav>

  <div id="cartPage" class="page-slide">
    <div style="padding:15px; display:flex; align-items:center; gap:15px; border-bottom:1px solid #333;">
      <button onclick="el('cartPage').classList.remove('active')" class="btn-view-cart" style="padding:8px 15px;">‚Üê</button>
      <span style="font-weight:700;">Finalizar Pedido</span>
    </div>
    <div class="page-content">
      <div id="cartItems"></div>
      
      <h3 style="color:var(--accent); font-size:14px; margin-top:20px;">üìç ENTREGA</h3>
      <button onclick="getLocation()" class="btn location">üìç CLIQUE PARA LOCALIZAR AGORA</button>
      <div class="map-container"><div id="map"></div></div>
      
      <input id="clientAddress" class="clean-input" placeholder="Rua e Bairro *">
      <input id="houseNumber" class="clean-input" placeholder="N√∫mero e Refer√™ncia *">
      <input id="clientName" class="clean-input" placeholder="Seu Nome *">

      <h3 style="color:var(--accent); font-size:14px; margin-top:20px;">üí≥ PAGAMENTO</h3>
      <div class="pay-option" style="padding:12px; background:#2c2c2e; border-radius:12px; margin-bottom:8px;" onclick="selectPay(this, 'dinheiro')">üíµ Dinheiro</div>
      <div id="cashChange" style="display:none;"><input id="cashGiven" type="number" class="clean-input" placeholder="Troco para quanto?"></div>
      <div class="pay-option" style="padding:12px; background:#2c2c2e; border-radius:12px; margin-bottom:8px;" onclick="selectPay(this, 'pix')">üí† PIX</div>
      <div class="pay-option" style="padding:12px; background:#2c2c2e; border-radius:12px; margin-bottom:8px;" onclick="selectPay(this, 'cartao')">üí≥ Cart√£o</div>

      <div style="margin-top:20px; border-top:1px dashed #333; padding-top:15px;">
        <div style="display:flex; justify-content:space-between; font-size:18px; font-weight:800; color:var(--accent);"><span>Total</span> <span id="totalText">R$ 0,00</span></div>
      </div>

      <div style="margin-top: 25px;">
          <button id="backToMenu" class="btn back">Voltar para o Card√°pio</button>
          <button id="confirmBtn" class="btn primary">Enviar Pedido para WhatsApp</button>
      </div>
    </div>
  </div>

  <div id="modal" class="modal-back">
    <div class="modal-card">
      <img id="modalImg" style="width:100%; height:180px; object-fit:cover; border-radius:12px; margin-bottom:15px;">
      <h2 id="modalTitle" style="margin:0;"></h2>
      <div style="font-size:22px; font-weight:800; color:var(--accent); margin:10px 0;">R$ <span id="modalPrice">0,00</span></div>
      <textarea id="note" class="clean-input" style="height:80px;" placeholder="Observa√ß√µes..."></textarea>
      <button id="addCart" class="btn primary">Adicionar √† Sacola</button>
      <button onclick="el('modal').style.display='none'" class="btn ghost">Cancelar</button>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const CONFIG = { phone: '5534984405375', fee: 4.99 };
    const DB = [
      {"id":"i_cq","cat":"hamburgueres","name":"Cachorro Quente na Chapa","desc":"P√£o, salsicha, mortadela, mussarela...","price":7.0, "image":"cachoro quente na chapa.jpeg"},
      {"id":"i_hb","cat":"hamburgueres","name":"Hamb√∫rguer","desc":"P√£o, carne, batata, alface...","price":12.0, "image":"logo.jpeg"},
      {"id":"i_xb","cat":"hamburgueres","name":"X-Burguer","desc":"P√£o, carne, mussarela...","price":15.0, "image":"xburguer.jpeg"},
      {"id":"i_xtudo","cat":"hamburgueres","name":"X-Tudo","desc":"P√£o, carne, bacon, ovo...","price":25.0, "image":"xtudo.jpeg"},
      {"id":"i_av","cat":"hamburgueres","name":"Avalanches","desc":"Completo da casa","price":27.0, "image":"Avalanche.jpeg"},
      {"id":"b_coca2","cat":"bebidas","name":"Coca-Cola 2L","desc":"Gelada","price":15.0, "image":"coca-cola 2l.jpg"}
    ];

    let CART = {};
    let PAYMENT = '';
    let map, marker;
    const el = id => document.getElementById(id);

    function checkOpen() {
      const h = new Date().getHours();
      const isOpen = (h >= 19 || h < 3);
      const b = el('storeStatus');
      if(isOpen) { b.innerHTML = '<span class="status-dot" style="background:var(--success)"></span> Aberto Agora'; } 
      else { b.innerHTML = '<span class="status-dot" style="background:var(--danger)"></span> Fechado no Momento'; }
    }
    checkOpen();

    function render(cat='all', q='') {
      const list = el('menuList'); list.innerHTML='';
      DB.filter(i => (cat==='all' || i.cat===cat) && i.name.toLowerCase().includes(q.toLowerCase())).forEach(it => {
        const div = document.createElement('div');
        div.className = 'card';
        div.onclick = () => openProd(it);
        div.innerHTML = `<div class="thumb"><img src="${it.image}"></div><div class="info"><div><div style="font-weight:700">${it.name}</div><div style="font-size:12px;color:#999">${it.desc}</div></div><div class="price">R$ ${it.price.toFixed(2)}</div></div>`;
        list.appendChild(div);
      });
    }

    function openProd(it) {
      currentProd = it;
      el('modalTitle').innerText = it.name;
      el('modalImg').src = it.image;
      el('modalPrice').innerText = it.price.toFixed(2);
      el('modal').style.display = 'flex';
    }

    el('addCart').onclick = () => {
      CART[currentProd.id] = { name: currentProd.name, price: currentProd.price, note: el('note').value };
      el('modal').style.display='none';
      updateCartBar();
    };

    function updateCartBar() {
      let sub = 0, count = 0;
      for(let k in CART) { sub += CART[k].price; count++; }
      el('cartbar').style.display = count > 0 ? 'flex' : 'none';
      el('cartSubtotal').innerText = "R$ " + (sub + CONFIG.fee).toFixed(2);
      el('totalText').innerText = "R$ " + (sub + CONFIG.fee).toFixed(2);
    }

    function initMap(lat = -15.487, lon = -44.367) {
      if(map) { map.setView([lat, lon], 17); marker.setLatLng([lat, lon]); return; }
      map = L.map('map').setView([lat, lon], 17);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
      marker = L.marker([lat, lon], {draggable: true}).addTo(map);
    }

    function getLocation() {
      navigator.geolocation.getCurrentPosition((pos) => {
        const lat = pos.coords.latitude; const lon = pos.coords.longitude;
        initMap(lat, lon);
        fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`)
        .then(r => r.json()).then(d => {
          if(d.display_name) el('clientAddress').value = d.display_name.split(',')[0] + ', ' + d.display_name.split(',')[1];
        });
      }, () => alert("Ative seu GPS!"));
    }

    el('openCartBtn').onclick = () => { el('cartPage').classList.add('active'); setTimeout(() => initMap(), 400); };
    el('backToMenu').onclick = () => el('cartPage').classList.remove('active');
    
    el('confirmBtn').onclick = () => {
        const name = el('clientName').value;
        if(!name) return alert("Digite seu nome");
        window.open(`https://wa.me/${CONFIG.phone}?text=Ol√°, quero fazer um pedido!`);
    };

    render();
  </script>
</body>
</html>
